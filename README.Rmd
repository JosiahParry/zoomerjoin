---
output: github_document
always_allow_html: true
---

```{r, include=F}
library(tidyverse)
library(microbenchmark)
library(fuzzyjoin)

rextendr::document()
devtools::load_all()

n <- 500000
corpus_1 <- read_csv("vignettes/bonica.csv")  %>%
    head(n)
names(corpus_1) <- c("a", "field")
corpus_2 <- read_csv("vignettes/bonica.csv")  %>%
    tail(n)
names(corpus_2) <- c("b", "field")
```


# zoomerjoin
<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![Codecov test coverage](https://codecov.io/gh/beniaminogreen/zoomerjoin/branch/main/graph/badge.svg)](https://app.codecov.io/gh/beniaminogreen/zoomerjoin?branch=main)
<!-- badges: end -->

zoomerjoin is an R package that empowers you to fuzzy-join massive datasets
rapidly, and with little memory consumption. Its backbone is a high-performance
implementation of [MinHash](https://en.wikipedia.org/wiki/MinHash), an
algorithm which shortcuts the expensive computational step of comparing all
possible pairings of records between the two datasets. In practice, this means
zoomerjoin can fuzzily-join datasets days, or even years faster than other
matching packages. zoomerjoin has been used in-production to join datasets of
hundreds of millions of names in a few hours.

The package also wraps the [kdtree](https://docs.rs/kdtree/latest/kdtree/) Rust
crate to provide blazingly fast spatial joins.


#### Installation

---

##### Installing Rust:

You must have [Rust](https://www.rust-lang.org/tools/install) installed to
compile this package. After the package is compiled, Rust is no longer
required, and can be safely uninstalled.

To install Rust on windows, you can use the Rust installation wizard, found
[here](https://forge.rust-lang.org/infra/other-installation-methods.html). On
Linux or MacOs, you can install Rust with:

``` sh
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```


##### Installing Package from Github:

Once you have rust installed Rust, you should be able to install the package
with:

``` r
#install.packages("devtools")
devtools::install_github("beniaminogreen/zoomerjoin")
```

### Usage:

---

zoomerjoin provides the lsh_join family of functions, which are designed to be
near drop-ins for the corresponding dplyr/fuzzyjoin commands:

* `lsh_left_join()`
* `lsh_right_join()`
* `lsh_inner_join()`
* `lsh_full_join()`
* `lsh_anti_join()`

Here's a snippet showing off how to use the `lhs_left_join()` command:

I start with two corpses I would like to combine, `corpus_1`:

```{r}
corpus_1
```

And `corpus_2`:
```{r}
corpus_2
```

The two Corpuses can't be directly joined because of misspellings. This means
we must use the fuzzy-matching capabilities of zoomerjoin:

```{r}
start_time <- Sys.time()
join_out <- lsh_inner_join(corpus_1, corpus_2, n_gram_width=6, n_bands=20, band_width=6)
print(Sys.time() - start_time)
print(join_out)
```

ZoomerJoin finds and joins on the matching rows in just a few seconds.

## References:

Bonica, Adam. 2016. Database on Ideology, Money in Politics, and Elections: Public version 2.0 [Computer file]. Stanford, CA: Stanford University Libraries.
